import { formatDatetime } from "@/common/utils/formatting/datetime";
import { toNumberIfDefined } from "@/common/utils/general/toNumberIfDefined";
import { ISoulmaskServerStateInfo } from "@/features/adapters/soulmask/types/ISoulmaskServerStateInfo";
import { IAdapterSpec } from "@/features/adapters/types/IAdapterSpec";

// FIXME
const SOULMASK_RE = {
  serverSaved: /\[server] Saved/i,
  playerJoined: /\[online] Added Peer #\d+/i,
  playerLeft: /\[online] Removed Peer #\d+/i,
};

export const SOULMASK_ADAPTER_SPEC: IAdapterSpec<
  "soulmask",
  ISoulmaskServerStateInfo
> = {
  id: "soulmask",
  name: "Soulmask",
  logo: {
    src: "data:image/jpeg;base64,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",
    height: 136,
    width: 369,
    omitTextFromLogoBanner: true,
  },
  configSpecs: {
    "Engine.ini": {
      type: "ini",
      indent: "\t",
      newline: "\n",
      newlineEof: false,
    },
  },
  // FIXME
  stateInfoSpec: {
    checkStarted: (data, _current) =>
      /\[Session] 'HostOnline' \(up\)!/i.test(data),
    infoGetters: [
      (data, _current) => ({
        gameVersion: data.match(/Game Version \(SVN\): (\d+)/i)?.[1],
      }),
      (data, _current) => {
        const countingMatches = data.match(
          /\[savexxx] LOAD (\d+) bases (\d+) entities/i,
        );

        return {
          baseCount: toNumberIfDefined(countingMatches?.[1]),
          entityCount: toNumberIfDefined(countingMatches?.[2]),
        };
      },
      (data, _current) => ({
        publicIp: data.match(
          /\[online] Public ipv4: (\d+\.\d+\.\d+\.\d+)/i,
        )?.[1],
      }),
      (data, current) => ({
        lastSaved: SOULMASK_RE.serverSaved.test(data)
          ? formatDatetime(new Date(), true)
          : undefined,
        savedCount: SOULMASK_RE.serverSaved.test(data)
          ? (current?.savedCount ?? 0) + 1
          : undefined,
      }),
      (data, current) => {
        let currentPlayerCount = current?.playerCount ?? 0;
        let isJoinEvent = false;
        let isLeaveEvent = false;
        if (SOULMASK_RE.playerJoined.test(data)) {
          isJoinEvent = true;
          currentPlayerCount++;
        }
        if (SOULMASK_RE.playerLeft.test(data)) {
          isLeaveEvent = true;
          currentPlayerCount--;
        }

        return {
          playerCount: currentPlayerCount,
          lastLoggedOn: isJoinEvent
            ? formatDatetime(new Date(), true)
            : undefined,
          lastLoggedOff: isLeaveEvent
            ? formatDatetime(new Date(), true)
            : undefined,
        };
      },
    ],
  },
};
